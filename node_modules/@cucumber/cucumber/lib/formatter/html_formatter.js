"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const node_stream_1 = require("node:stream");
const node_util_1 = require("node:util");
const resolve_pkg_1 = __importDefault(require("resolve-pkg"));
const html_formatter_1 = __importDefault(require("@cucumber/html-formatter"));
const _1 = __importDefault(require("."));
class HtmlFormatter extends _1.default {
    _htmlStream;
    static documentation = 'Outputs HTML report';
    constructor(options) {
        super(options);
        this._htmlStream = new html_formatter_1.default((0, resolve_pkg_1.default)('@cucumber/html-formatter', { cwd: __dirname }) +
            '/dist/main.css', (0, resolve_pkg_1.default)('@cucumber/html-formatter', { cwd: __dirname }) +
            '/dist/main.js');
        options.eventBroadcaster.on('envelope', (envelope) => {
            this._htmlStream.write(envelope);
        });
        this._htmlStream.on('data', (chunk) => this.log(chunk));
    }
    async finished() {
        this._htmlStream.end();
        await (0, node_util_1.promisify)(node_stream_1.finished)(this._htmlStream);
        await super.finished();
    }
}
exports.default = HtmlFormatter;
//# sourceMappingURL=html_formatter.js.map